<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>VÃ²ng quay may máº¯n</title>
<style>
/* ----- BODY & BACKGROUND ----- */
body {
 margin: 0;
 font-family: 'Poppins', sans-serif;
 background: linear-gradient(135deg, #8b5cf6, #2563eb, #ec4899);
 background-size: 400% 400%;
 animation: bgMove 12s ease infinite;
 min-height: 100vh;
 display: flex;
 flex-direction: column;
 align-items: center;
 padding-top: 30px;
 color: white;
 overflow-x: hidden;
}
@keyframes bgMove {
 0% { background-position: 0% 50%; }
 50% { background-position: 100% 50%; }
 100% { background-position: 0% 50%; }
}
/* ----- RESPONSIVE ADMIN ----- */
@media (max-width: 600px) {
 #adminBtns {
 flex-direction: column;
gap: 15px;
margin-top: 20px;
 }
 #adminBtns button {
width: 80%;
 padding: 12px 0;
 font-size: 16px;
 }
 #selectAllContainer {
 text-align: center;
 margin-bottom: 15px;
font-size: 14px;
 }
 #selectAllContainer input[type="checkbox"] {
 transform: scale(1.2);
 margin-right: 6px;
 }
}

/* ----- LOGIN OVERLAY ----- */
#loginOverlay {
position: fixed;
 top: 0; left: 0;
 width: 100%; height: 100%;
 background: rgba(0,0,0,0.6); display: flex;
 justify-content: center;
 align-items: center;
 z-index: 1000;
 backdrop-filter: blur(6px);
 animation: fadeIn 0.5s ease forwards;
}
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

.loginBox {
 background: rgba(255,255,255,0.12);
 padding: 40px 50px;
 border-radius: 25px;
 box-shadow: 0 10px 30px rgba(0,0,0,0.6);
 text-align: center;
color: white;
min-width: 320px;
 max-width: 500px;
 width: 90%;
 animation: slideUp 0.5s ease forwards;
}
@keyframes slideUp { from { transform: translateY(50px); opacity:0; } to { transform: translateY(0); opacity:1; } }

.loginBox h2 {
margin-bottom: 25px;
 font-size: 28px;
 text-shadow: 0 4px 15px rgba(0,0,0,0.4);
}

.loginBox input,
.loginBox button {
 width: 100%;
 padding: 14px 18px;
 border-radius: 12px;
 border: none;
 font-size: 18px;
 outline: none;
 box-shadow: inset 0 4px 10px rgba(0,0,0,0.2);
 background: rgba(255,255,255,0.2);
 color: white;
 margin-bottom: 20px;
 box-sizing: border-box;
}
.loginBox button {
 background: linear-gradient(135deg, #8b5cf6, #6366f1);
 font-weight: bold;
 cursor: pointer;
 transition: 0.3s;
}
.loginBox button:hover {
 transform: scale(1.05);
 box-shadow: 0 8px 20px rgba(0,0,0,0.45);
}

/* ----- GRID & CELLS ----- */
h1 { font-size: 42px; font-weight: 700; margin-bottom: 10px; text-align: center; text-shadow: 0 4px 20px rgba(0,0,0,0.4);}
.grid { display: grid; grid-template-columns: repeat(8, 150px); grid-auto-rows: 75px; gap: 18px; margin-top: 40px;}
.cell {
 display: flex; justify-content: center; align-items: center;
 background: rgba(255,255,255,0.25); border: 2px solid rgba(255,255,255,0.4);
 border-radius: 15px; font-weight: 600; font-size: 18px; color: white;
 cursor: grab; transition: 0.25s; box-shadow: 0 6px 18px rgba(0,0,0,0.25);
 user-select: none;
}
.cell.dragging { opacity: 0.5; transform: scale(1.05); cursor: grabbing; }
.cell.empty { background: rgba(255,255,255,0.05); border: 2px dashed rgba(255,255,255,0.3); cursor: pointer; }
.selected { background: linear-gradient(135deg, #60a5fa, #2563eb); border-color: #ffffff; transform: scale(1.07); box-shadow: 0 0 20px #60a5fa; }
.btn-area { margin-top: 40px; display: flex; gap: 30px; flex-wrap: wrap; justify-content: center;}
button { padding: 14px 30px; border: none; border-radius: 15px; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.25s; color: white; text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 6px 15px rgba(0,0,0,0.25);}
#startBtn { background: linear-gradient(135deg, #8b5cf6, #6366f1);}
#stopBtn { background: linear-gradient(135deg, #ec4899, #db2777);}
#confirmBtn {justify-content: center;align-items: center; display: none; padding: 20px 40px; font-size: 28px; border: none; border-radius: 20px; background: linear-gradient(135deg, #facc15, #f59e0b); color: black; font-weight: bold; cursor: pointer; box-shadow: 0 6px 15px rgba(0,0,0,0.25); width: 80%; max-width: 400px; margin-top: 450px;}
#resultBox { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); background: white; padding: 40px 60px; border-radius: 25px; box-shadow: 0 0 35px rgba(0,0,0,0.45); font-size: 40px; font-weight: 700; color: #2563eb; opacity: 0; transition: 0.35s ease; z-index: 999;}
#resultBox.show { transform: translate(-50%, -50%) scale(1); opacity: 1;}
canvas#fireworks { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 998;}
#cancelBtn { padding:20px 40px; font-size:24px; border-radius:15px; background: linear-gradient(135deg, #f87171, #ef4444); color:white; font-weight:bold; cursor:pointer; margin-top:500px; display: none;}


/* ----- RESPONSIVE ----- */
@media (max-width: 600px) {
 .grid { grid-template-columns: repeat(4, 45vw); grid-auto-rows: 20vw; gap: 10px; margin-top: 20px;}
 h1 { font-size: 32px; }
}
</style>
</head>
<body>

<script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>

<div id="loginOverlay">
Â  <div class="loginBox">
Â  Â  <h2>Nháº­p tÃªn cá»§a báº¡n</h2>
Â  Â  <input type="text" id="usernameInput" placeholder="Nháº­p tÃªn..." />
Â  Â  <p id="loginError" style="color:#ffb4b4; font-size:14px; margin-top:-10px; height:18px;"></p>
Â  Â  <button id="loginBtn">Báº¯t Ä‘áº§u</button>
Â  </div>
</div>

<canvas id="fireworks"></canvas>
<h1>VÃ²ng quay may máº¯n</h1>

<div class="grid" id="grid"></div>

<div class="btn-area" id="adminBtns">
Â  <button id="startBtn">Báº¯t Ä‘áº§u</button>
Â  <button id="stopBtn">Dá»«ng</button>
</div>
<div id="adminControls" style="display:none; align-items:center; gap:10px; margin-top:20px;">
Â  <input type="checkbox" id="selectAllCheckbox" />
Â  <label for="selectAllCheckbox" style="color:white; font-weight:bold;">Chá»n táº¥t cáº£</label>
</div>

<button id="confirmBtn">Tham gia</button>
<button id="cancelBtn">Há»§y tham gia</button>


<div id="resultBox"></div>
<audio id="tickSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_7f4fb39984.mp3"></audio>

<script>
// ----- DANH SÃCH & CÃ€I Äáº¶T -----
const names = [
"Trung KiÃªn","Gia Khang","Nam NguyÃªn","Báº£o Ngá»c","HoÃ ng Gia","KhÃ¡nh Dung","Äan LÃª","Minh Huy",
"Quá»³nh NhÆ°","Quang Nam","PhÃº Thá»‹nh","Táº¥n TÃ i",
"VÄƒn HÃ o","HoÃ ng Anh","HoÃ ng Long","Gia Huy",
"Gia PhÃºc","Diá»‡u Minh","CÃ´ng TrÃ­","Minh QuÃ¢n","VÃµ Gia HÃ¢n","Thu An","PhÆ°Æ¡ng Linh",
"Tháº£o Hiá»n","HoÃ ng Phong","HÃ¹ng Minh",
"ThÃºy Vy","HoÃ ng PhÆ°Æ¡ng","Gia HÃ¢n","Äá»©c An","Anh Kiá»‡t","Gia HÆ°ng","HoÃ ng Nhi","Diá»…m My","Nam Trung","KhÃ¡nh Quá»³nh","LiÃªn Giang",
"TrÃ¢m Anh","CÃ´ng Khoa","Nháº­t Huy","Tháº£o NguyÃªn","Háº¡nh Nghi","Báº£o TrÃ¢n",
"Minh ThÆ°","Anh Äá»©c","Há»“ng ChuyÃªn"
];

const grid = document.getElementById("grid");
const adminBtns = document.getElementById("adminBtns");
const confirmBtn = document.getElementById("confirmBtn");
const cancelBtn = document.getElementById("cancelBtn");
const resultBox = document.getElementById("resultBox");
const tick = document.getElementById("tickSound");
const adminControls = document.getElementById("adminControls");

let selected = [];
let interval;
let currentIndex = 0;
let role = '';
let username = '';
let hasJoined = false;

const adminName = "backy";
const SERVER_PORT = 3000;
// THAY Äá»”I 'localhost' thÃ nh IP cá»§a mÃ¡y Server Node.js náº¿u báº¡n cháº¡y trÃªn mÃ¡y khÃ¡c!
const socket = io('https://random-picker-4eht.onrender.com');


// ----- INIT VÃ€ LOGIN -----
window.addEventListener('DOMContentLoaded', () => {
Â  // Äáº£m báº£o mÃ n hÃ¬nh Ä‘Äƒng nháº­p hiá»‡n ra Ä‘áº§u tiÃªn
Â  document.getElementById('loginOverlay').style.display = 'flex';
Â  document.getElementById('usernameInput').value = '';
Â  adminBtns.style.display = 'none';
Â  confirmBtn.style.display = 'none';
Â  cancelBtn.style.display = 'none';
Â  adminControls.style.display = 'none';
});

document.getElementById('loginBtn').addEventListener('click', () => {
    const inputName = document.getElementById('usernameInput').value.trim();
    const errorMsg = document.getElementById('loginError');
    errorMsg.innerText = "";

    if (!inputName) {
        errorMsg.innerText = "âš  Vui lÃ²ng nháº­p tÃªn!";
        return;
    }

    let nextRole = '';
    const userIndex = names.indexOf(inputName);

    // XÃ¡c Ä‘á»‹nh vai trÃ²
    if (inputName === adminName) {
        nextRole = 'admin';
    } else if (userIndex !== -1) { 
        nextRole = 'user';
    } else {
        errorMsg.innerText = "âš  TÃªn khÃ´ng tá»“n táº¡i trong danh sÃ¡ch!";
        return;
    }

    // LÆ¯U TRáº NG THÃI Táº M THá»œI VÃ€ Gá»¬I YÃŠU Cáº¦U LÃŠN SERVER
    username = inputName;
    role = nextRole;
    
    // Gá»­i yÃªu cáº§u Ä‘Äƒng nháº­p lÃªn Server
    socket.emit('client_login', { username: inputName, role: nextRole, index: userIndex });
});

// --- Láº®NG NGHE PHáº¢N Há»’I ÄÄ‚NG NHáº¬P Tá»ª SERVER ---
socket.on('login_status', (data) => {
    const errorMsg = document.getElementById('loginError');

    if (data.success) {
        // ÄÄƒng nháº­p thÃ nh cÃ´ng
        errorMsg.innerText = "";
        document.getElementById('loginOverlay').style.display = 'none';

        if (role === 'admin') {
            adminBtns.style.display = 'flex';
            confirmBtn.style.display = 'none';
            cancelBtn.style.display = 'none';
            adminControls.style.display = 'flex';
            renderGrid();
        } else {
            // Náº¿u lÃ  user, Ä‘á»“ng bá»™ tráº¡ng thÃ¡i tham gia ban Ä‘áº§u (sáº½ Ä‘Æ°á»£c xá»­ lÃ½ bá»Ÿi 'initial_state')
            adminBtns.style.display = 'none';
            confirmBtn.style.display = 'flex';
            // KhÃ´ng hiá»ƒn thá»‹ confirmBtn/cancelBtn á»Ÿ Ä‘Ã¢y, chá» 'initial_state'
        }
    } else {
        // ÄÄƒng nháº­p tháº¥t báº¡i (do trÃ¹ng láº·p)
        errorMsg.innerText = data.message;
        // Reset tráº¡ng thÃ¡i táº¡m thá»i
        role = '';
        username = '';
    }
});


// ----- GRID & RENDER -----
function createCell(name, idx, isEmpty=false){
Â  const cell = document.createElement("div");
Â  cell.className = "cell";
Â  if(isEmpty) cell.classList.add('empty');
Â  cell.innerText = name;
Â  cell.dataset.index = idx;
Â  cell.setAttribute('draggable', true);

Â  // Logic Drag & Drop (Chá»‰ cho Admin)
Â  if(role === 'admin') {
Â  Â  cell.addEventListener('dragstart', e => {
Â  Â  Â  e.dataTransfer.setData('text/plain', idx);
Â  Â  Â  cell.classList.add('dragging');
Â  Â  });
Â  Â  cell.addEventListener('dragend', () => cell.classList.remove('dragging'));
Â  Â  cell.addEventListener('dragover', e => e.preventDefault());
Â  Â  cell.addEventListener('drop', e => {
Â  Â  Â  e.preventDefault();
Â  Â  Â  const fromIndex = e.dataTransfer.getData('text');
Â  Â  Â  const toIndex = idx;
Â  Â  Â  if (fromIndex === toIndex) return;

Â  Â  Â  const fromCell = document.querySelector(`[data-index='${fromIndex}']`);
Â  Â  Â  const toCell = document.querySelector(`[data-index='${toIndex}']`);
Â  Â  Â  const temp = fromCell.innerText;
Â  Â  Â  fromCell.innerText = toCell.innerText;
Â  Â  Â  toCell.innerText = temp;
Â  Â  Â  [names[fromIndex], names[toIndex]] = [names[toIndex], names[fromIndex]];
Â  Â  Â  // Sau khi swap, cáº§n Ä‘á»“ng bá»™ láº¡i tráº¡ng thÃ¡i selected cho Ä‘Ãºng ngÆ°á»i
Â  Â  Â  selected.forEach((s, i) => {
Â  Â  Â  Â  if (s == fromIndex) selected[i] = toIndex;
Â  Â  Â  Â  else if (s == toIndex) selected[i] = fromIndex;
Â  Â  Â  });
Â  Â  });
Â  }

Â  if(!isEmpty && role==='admin'){
Â  Â  cell.addEventListener('click', ()=>{
Â  Â  Â  cell.classList.toggle('selected');
Â  Â  Â  
Â  Â  Â  // Logic chá»n/bá» chá»n
Â  Â  Â  if (selected.includes(idx)) {
Â  Â  Â  Â  selected = selected.filter(x => x!==idx);
Â  Â  Â  } else {
Â  Â  Â  Â  selected.push(idx);
Â  Â  Â  }
Â  Â  Â  // Bá» chá»n Select All náº¿u cÃ³ cell bá»‹ bá» chá»n
Â  Â  Â  if (document.getElementById('selectAllCheckbox').checked && !cell.classList.contains('selected')) {
Â  Â  Â  Â  document.getElementById('selectAllCheckbox').checked = false;
Â  Â  Â  }
Â  Â  });
Â  }
Â  return cell;
}

function renderGrid(){
Â  grid.innerHTML = '';
Â  let nameIndex = 0;
Â  for(let row=1; row<=6; row++){
Â  Â  for(let col=1; col<=8; col++){
Â  Â  Â  let cell;
Â  Â  Â  // Táº¡o 2 Ã´ trá»‘ng á»Ÿ vá»‹ trÃ­ 1,5 vÃ  1,6
Â  Â  Â  if(row===1 && (col===5 || col===6)){
Â  Â  Â  Â  cell = createCell('', `empty-${row}-${col}`, true);
Â  Â  Â  } else {
Â  Â  Â  Â  const name = names[nameIndex] || '';
Â  Â  Â  Â  cell = createCell(name, nameIndex);
Â  Â  Â  Â  nameIndex++;
Â  Â  Â  }
Â  Â  Â  grid.appendChild(cell);
Â  Â  }
Â  }
Â  // Sau khi render, Ã¡p dá»¥ng láº¡i tráº¡ng thÃ¡i selected (chá»‰ cho Admin)
Â  if (role === 'admin') {
Â  Â  selected.forEach(idx => {
Â  Â  Â  const cell = document.querySelector(`[data-index='${idx}']`);
Â  Â  Â  if(cell) cell.classList.add('selected');
Â  Â  });
Â  }
}


// ----- ADMIN CONTROLS -----
document.getElementById("startBtn")?.addEventListener('click', ()=>{
Â  if(!selected.length) return alert("Chá»n Ã­t nháº¥t 1 ngÆ°á»i!");
Â  
Â  // BÃ¡o cho Server/User biáº¿t Admin báº¯t Ä‘áº§u quay
Â  socket.emit('admin_start_wheel');

Â  // Reset há»™p káº¿t quáº£
Â  resultBox.classList.remove("show");

Â  interval = setInterval(()=>{
Â  Â  // Loáº¡i bá» lá»›p 'selected' á»Ÿ Ã´ trÆ°á»›c
Â  Â  const oldIdx = selected[currentIndex === 0 ? selected.length-1 : currentIndex-1];
Â  Â  const oldCell = document.querySelector(`[data-index='${oldIdx}']`);
Â  Â  if(oldCell) oldCell.classList.remove("selected");

Â  Â  // ThÃªm lá»›p 'selected' á»Ÿ Ã´ hiá»‡n táº¡i
Â  Â  const idx = selected[currentIndex];
Â  Â  const cell = document.querySelector(`[data-index='${idx}']`);
Â  Â  if(cell) cell.classList.add("selected");

Â  Â  tick.currentTime=0;
Â  Â  tick.play();

Â  Â  currentIndex=(currentIndex+1)%selected.length;
Â  },50);
});

document.getElementById("stopBtn")?.addEventListener('click', ()=>{
Â  if(!selected.length) return alert("Chá»n Ã­t nháº¥t 1 ngÆ°á»i!");
Â  
Â  clearInterval(interval);
Â  const winnerIndex = selected[currentIndex===0?selected.length-1:currentIndex-1];
Â  const winnerName = names[winnerIndex];
Â  
Â  // Gá»­i káº¿t quáº£ chiáº¿n tháº¯ng Ä‘áº¿n Server
Â  socket.emit('admin_stop_wheel', winnerName);

Â  // Xá»­ lÃ½ hiá»ƒn thá»‹ káº¿t quáº£ cá»¥c bá»™ trÃªn mÃ¡y Admin
Â  resultBox.innerText = "ğŸ‰ "+winnerName+" ğŸ‰";
Â  resultBox.classList.add("show");
Â  startFireworks();

Â  // >>> Bá»” SUNG: LOáº I Bá» HIá»†U á»¨NG SELECTED TRÃŠN CÃC Ã” TRÃŠN MÃY ADMIN
Â  document.querySelectorAll('.cell').forEach(cell => {
Â  Â  cell.classList.remove('selected');
Â  });
Â  
Â  // Reset tráº¡ng thÃ¡i Admin
Â  selected=[];
Â  currentIndex=0;
Â  document.getElementById('selectAllCheckbox').checked = false;
});

const selectAllCheckbox = document.getElementById('selectAllCheckbox');
selectAllCheckbox.addEventListener('change', () => {
Â  if(!names.length || role !== 'admin') return;
Â  
Â  selected = [];
Â  document.querySelectorAll('.cell').forEach((cell, idx) => {
Â  Â  // Chá»‰ chá»n/bá» chá»n cÃ¡c Ã´ cÃ³ tÃªn vÃ  khÃ´ng pháº£i Ã´ trá»‘ng
Â  Â  if(cell.innerText.trim() && !cell.classList.contains('empty')){
Â  Â  Â  if(selectAllCheckbox.checked){
Â  Â  Â  Â  cell.classList.add('selected');
Â  Â  Â  Â  selected.push(idx);
Â  Â  Â  } else {
Â  Â  Â  Â  cell.classList.remove('selected');
Â  Â  Â  }
Â  Â  }
Â  });
});


// ----- USER CONTROLS -----
confirmBtn?.addEventListener('click', ()=>{
Â  if(!username) return;
Â  const userIndex = names.indexOf(username);
Â  if(userIndex===-1) return;
Â Â 
Â  // Gá»­i thÃ´ng tin tham gia lÃªn Server
Â  socket.emit('user_join', {index:userIndex, username: username});
Â  
Â  
Â  hasJoined = true;
Â  confirmBtn.style.display = 'none';
Â  cancelBtn.style.display = 'block';
});

cancelBtn?.addEventListener('click', ()=>{
Â  if(!hasJoined) return;
Â  const userIndex = names.indexOf(username);
Â  if(userIndex===-1) return;

Â  // Gá»­i thÃ´ng tin há»§y tham gia lÃªn Server
Â  socket.emit('user_cancel', {index:userIndex, username: username});
Â  
Â  
Â  hasJoined = false;
Â  confirmBtn.style.display = 'block';
Â  cancelBtn.style.display = 'none';
});


// ----- SOCKET.IO LISTENERS (Äá»’NG Bá»˜ HÃ“A) -----

// 1. Nháº­n tráº¡ng thÃ¡i ban Ä‘áº§u khi káº¿t ná»‘i
socket.on('initial_state', (data) => {
Â  Â  const allCells = document.querySelectorAll(".cell");
Â  Â  allCells.forEach(c=>c.classList.remove("selected"));

Â  Â  if (role === 'admin') {
Â  Â  Â  Â  selected = [];
Â  Â  Â  Â  // Hiá»ƒn thá»‹ cÃ¡c Ã´ Ä‘Ã£ Ä‘Æ°á»£c chá»n trÃªn giao diá»‡n Admin
Â  Â  Â  Â  data.participants.forEach(p => {
Â  Â  Â  Â  Â  Â  selected.push(p.index);
Â  Â  Â  Â  Â  Â  const cell = document.querySelector(`[data-index='${p.index}']`);
Â  Â  Â  Â  Â  Â  if(cell) cell.classList.add('selected');
Â  Â  Â  Â  });
Â  Â  }
Â  Â  // User: Cáº­p nháº­t tráº¡ng thÃ¡i nÃºt Tham gia/Há»§y
Â  Â  if (role === 'user') {
Â  Â  Â  Â  hasJoined = data.participants.some(p => p.username === username);
Â  Â  Â  Â  confirmBtn.style.display = hasJoined ? 'none' : 'block';
Â  Â  Â  Â  cancelBtn.style.display = hasJoined ? 'block' : 'none';
Â  Â  }
Â  Â  // Náº¿u lÃ  Admin, pháº£i render grid sau khi Ä‘Äƒng nháº­p Ä‘á»ƒ táº¡o cell vÃ  event listener
Â  Â  if (role === 'admin' && grid.innerHTML === '') renderGrid();
});


// 2. ADMIN: Nháº­n thÃ´ng bÃ¡o user tham gia tá»« server
socket.on('client_update_join', (data) => {
Â  Â  if (role === 'admin') {
Â  Â  Â  Â  const idx = data.index;
Â  Â  Â  Â  if (!selected.includes(idx)) selected.push(idx);
Â  Â  Â  Â  const cell = document.querySelector(`[data-index='${idx}']`);
Â  Â  Â  Â  if(cell) cell.classList.add('selected');
Â  Â  }
});

// 3. ADMIN: Nháº­n thÃ´ng bÃ¡o user há»§y tá»« server
socket.on('client_update_cancel', (data) => {
Â  Â  if (role === 'admin') {
Â  Â  Â  Â  const idx = data.index;
Â  Â  Â  Â  selected = selected.filter(i => i !== idx);
Â  Â  Â  Â  const cell = document.querySelector(`[data-index='${idx}']`);
Â  Â  Â  Â  if(cell) cell.classList.remove('selected');
Â  Â  }
});

// 4. USER/ADMIN: Nháº­n káº¿t quáº£ vÃ  Ä‘á»“ng bá»™ hÃ³a hiá»ƒn thá»‹
socket.on('client_stop_wheel', (winnerName) => {
Â  Â  // Dá»«ng quay náº¿u Ä‘ang quay
Â  Â  clearInterval(interval); 
Â  Â  
Â  Â  resultBox.innerText = "ğŸ‰ " + winnerName + " ğŸ‰";
Â  Â  resultBox.classList.add("show");
Â  Â  startFireworks();

Â  Â  // Reset tráº¡ng thÃ¡i tham gia cho User
Â  Â  if (role === 'user') {
Â  Â  Â  Â  hasJoined = false;
Â  Â  Â  Â  confirmBtn.style.display = 'block';
Â  Â  Â  Â  cancelBtn.style.display = 'none';
Â  Â  }
});

// ----- FIREWORK -----
function startFireworks(){
Â  const canvas = document.getElementById("fireworks");
Â  const ctx = canvas.getContext("2d");
Â  canvas.width = innerWidth;
Â  canvas.height = innerHeight;
Â  const particles = [];
Â  // (Giá»¯ nguyÃªn hÃ m createParticle vÃ  animate)
Â  function createParticle(){
Â  Â  const p = {
Â  Â  Â  x: canvas.width/2,
Â  Â  Â  y: canvas.height/2,
Â  Â  Â  radius: Math.random()*3+2,
Â  Â  Â  color: `hsl(${Math.random()*360},100%,50%)`,
Â  Â  Â  dx:(Math.random()-0.5)*8,
Â  Â  Â  dy:(Math.random()-0.5)*8,
Â  Â  Â  life:100
Â  Â  };
Â  Â  particles.push(p);
Â  }
Â  for(let i=0;i<120;i++) createParticle();
Â  function animate(){
Â  Â  ctx.clearRect(0,0,canvas.width,canvas.height);
Â  Â  particles.forEach((p,i)=>{
Â  Â  Â  p.x+=p.dx; p.y+=p.dy; p.life--;
Â  Â  Â  ctx.fillStyle=p.color;
Â  Â  Â  ctx.beginPath(); ctx.arc(p.x,p.y,p.radius,0,Math.PI*2);
Â  Â  Â  ctx.fill();
Â  Â  Â  if(p.life<=0) particles.splice(i,1);
Â  Â  });
Â  Â  if(particles.length>0) requestAnimationFrame(animate);
Â  }
Â  animate();
}
// ----- CLICK NGOÃ€I ÄÃ“NG RESULT -----
document.addEventListener('click',(e)=>{
Â  if(resultBox.classList.contains('show') && !resultBox.contains(e.target) && e.target.id!=='stopBtn'){
Â  Â  resultBox.classList.remove('show');
Â  }
});
</script>
</body>

</html>
